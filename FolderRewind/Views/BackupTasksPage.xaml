<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="FolderRewind.Views.BackupTasksPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:FolderRewind.Models"
    NavigationCacheMode="Required">

    <Grid Padding="36">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Spacing="4" Margin="0,0,0,24">
            <TextBlock x:Uid="BackupTasksPage_Title" Style="{ThemeResource TitleTextBlockStyle}" AutomationProperties.HeadingLevel="Level1"/>
            <TextBlock Text="{x:Bind ViewModel.Count, Mode=OneWay, Converter={StaticResource CountToStringConverter}}" 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- 绑定到 Service 的静态列表 -->
        <ListView Grid.Row="1" SelectionMode="None" ItemsSource="{x:Bind TasksView, Mode=OneWay}">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Margin" Value="0,0,0,8"/>
                    <Setter Property="Padding" Value="0"/>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:BackupTask">
                    <Grid CornerRadius="8" Margin="4">
                        <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Translation="0,0,8" Padding="16">
                            <Grid.Shadow>
                                <ThemeShadow />
                            </Grid.Shadow>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Row 0: 标题行 - 图标、名称、状态、进度百分比 -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                                    <FontIcon Glyph="{x:Bind IconGlyph}" FontSize="16" Foreground="{ThemeResource SystemControlForegroundAccentBrush}"/>
                                    <TextBlock Text="{x:Bind FolderName}" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                    <TextBlock Text="-" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="{x:Bind Status, Mode=OneWay}" Foreground="{ThemeResource SystemControlForegroundAccentBrush}"/>
                                </StackPanel>

                                <!-- 进度百分比文字，仅在运行中且有确定进度时显示 -->
                                <TextBlock Grid.Column="1" 
                                           Text="{x:Bind ProgressText, Mode=OneWay}" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           VerticalAlignment="Center"
                                           Visibility="{x:Bind IsCompleted, Mode=OneWay, Converter={StaticResource BoolToVisInvertConverter}}"/>
                            </Grid>

                            <!-- Row 1: 进度条 - 支持不确定模式（脉冲动画）和确定模式（实际百分比） -->
                            <ProgressBar Grid.Row="1" 
                                         IsIndeterminate="{x:Bind IsIndeterminate, Mode=OneWay}"
                                         Value="{x:Bind Progress, Mode=OneWay}" 
                                         Maximum="100" 
                                         Margin="0,12,0,0" Height="4" CornerRadius="2"/>

                            <!-- Row 2: 失败原因 - 仅在有错误信息时显示 -->
                            <TextBlock Grid.Row="2" 
                                       Text="{x:Bind ErrorMessage, Mode=OneWay}"
                                       Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                       TextWrapping="Wrap"
                                       FontSize="12"
                                       Margin="0,8,0,0"
                                       MaxLines="3"
                                       TextTrimming="CharacterEllipsis"
                                       Visibility="{x:Bind ErrorMessage, Mode=OneWay, Converter={StaticResource StringNullOrEmptyToVisConverter}}"/>
                        </Grid>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- 空状态提示：当没有任务时显示 -->
        <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" 
                    Visibility="{x:Bind IsEmpty, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
            <FontIcon Glyph="&#xE8FB;" FontSize="48" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            <TextBlock x:Uid="BackupTasksPage_EmptyState" Margin="0,16,0,0" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>
    </Grid>
</Page>
