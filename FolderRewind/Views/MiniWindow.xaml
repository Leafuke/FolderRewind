<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="FolderRewind.Views.MiniWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="">

    <Grid x:Name="RootGrid"
          Background="Transparent"
          PointerPressed="RootGrid_PointerPressed"
          PointerMoved="RootGrid_PointerMoved"
          PointerReleased="RootGrid_PointerReleased"
          PointerCaptureLost="RootGrid_PointerCaptureLost">

        <Grid.ColumnDefinitions>
            <!-- 左侧展开区域 (默认折叠) -->
            <ColumnDefinition x:Name="LeftExpandColumn" Width="0"/>
            <!-- Mini 正方形主体 -->
            <ColumnDefinition Width="Auto"/>
            <!-- 右侧展开区域 (默认折叠) -->
            <ColumnDefinition x:Name="RightExpandColumn" Width="0"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧输入框展开区域 -->
        <Grid x:Name="LeftInputPanel" Grid.Column="0"
              Visibility="Collapsed"
              VerticalAlignment="Center"
              Margin="0,0,4,0">
            <Grid Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="8"
                  Padding="8,6"
                  MinWidth="180"
                  MaxWidth="200">
                <TextBox x:Name="LeftCommentBox"
                         PlaceholderText=""
                         BorderThickness="0"
                         Background="Transparent"
                         KeyDown="CommentBox_KeyDown"
                         LostFocus="CommentBox_LostFocus"
                         MinWidth="160"
                         MaxWidth="200"/>
            </Grid>
        </Grid>

        <!-- Mini 正方形主体 -->
        <Grid x:Name="MiniSquare" Grid.Column="1"
              Width="39" Height="39"
              PointerEntered="MiniSquare_PointerEntered"
              PointerExited="MiniSquare_PointerExited"
              Tapped="MiniSquare_Tapped"
              RightTapped="MiniSquare_RightTapped">

            <!-- 外层背景 
            <Border x:Name="OuterBorder"
                    CornerRadius="12"
                    Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                    BorderThickness="1"/>-->

            <!-- 色彩丝带（内边距形成环形效果） -->
            <Border x:Name="RibbonBorder"
                    CornerRadius="5"
                    Margin="3"
                    BorderThickness="2"
                    BorderBrush="{ThemeResource AccentFillColorDefaultBrush}"
                    Background="Transparent"/>

            <!-- 状态指示区域（仅在备份/完成/失败时显示图标） -->
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                <!-- 备份中动画指示器 -->
                <ProgressRing x:Name="BackupProgressRing"
                              IsActive="False"
                              Width="18" Height="18"
                              Visibility="Collapsed"/>

                <!-- 完成图标 -->
                <FontIcon x:Name="DoneIcon"
                          Glyph="&#xE73E;"
                          FontSize="14"
                          Foreground="{ThemeResource SystemFillColorSuccessBrush}"
                          Visibility="Collapsed"/>

                <!-- 失败图标 -->
                <FontIcon x:Name="FailIcon"
                          Glyph="&#xEA39;"
                          FontSize="14"
                          Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                          Visibility="Collapsed"/>
            </Grid>

            <!-- 悬停提示 -->
            <ToolTipService.ToolTip>
                <ToolTip x:Name="MiniTooltip"/>
            </ToolTipService.ToolTip>

            <!-- 右键菜单 -->
            <Grid.ContextFlyout>
                <MenuFlyout>
                    <MenuFlyoutItem x:Name="MenuItemOpenFolder" Text="" Click="OnContextOpenFolder">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE838;"/>
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutItem x:Name="MenuItemBackup" Text="" Click="OnContextBackup">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE898;"/>
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutSeparator/>
                    <MenuFlyoutItem x:Name="MenuItemExpandLeft" Text="" Click="OnContextToggleExpandDirection">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE76B;"/>
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                    <MenuFlyoutSeparator/>
                    <MenuFlyoutItem x:Name="MenuItemClose" Text="" Click="OnContextClose" Foreground="{ThemeResource SystemFillColorCriticalBrush}">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE711;"/>
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                </MenuFlyout>
            </Grid.ContextFlyout>
        </Grid>

        <!-- 右侧输入框展开区域 -->
        <Grid x:Name="RightInputPanel" Grid.Column="2"
              Visibility="Collapsed"
              VerticalAlignment="Center"
              Margin="4,0,0,0">
            <Grid Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="8"
                  Padding="8,6"
                  MinWidth="180"
                  MaxWidth="200">
                <TextBox x:Name="RightCommentBox"
                         PlaceholderText=""
                         BorderThickness="0"
                         Background="Transparent"
                         KeyDown="CommentBox_KeyDown"
                         LostFocus="CommentBox_LostFocus"
                         MinWidth="160"
                         MaxWidth="200"/>
            </Grid>
        </Grid>
    </Grid>
</Window>