<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="FolderRewind.Views.HistoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:FolderRewind.Models">

    <Grid Padding="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock x:Uid="HistoryPage_Title" Style="{ThemeResource TitleTextBlockStyle}" Margin="0,0,0,24"/>

        <!-- 筛选区 -->
        <Grid Grid.Row="1" Margin="0,0,0,24" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="200"/>
            </Grid.ColumnDefinitions>

            <!-- 移除了 ItemsSource绑定，改为代码设置 -->
            <ComboBox x:Name="ConfigFilter" x:Uid="HistoryPage_ConfigFilter" 
                      HorizontalAlignment="Stretch"
                      DisplayMemberPath="Name"
                      SelectionChanged="ConfigFilter_SelectionChanged"/>

            <ComboBox x:Name="FolderFilter" Grid.Column="1" x:Uid="HistoryPage_FolderFilter" 
                      HorizontalAlignment="Stretch"
                      DisplayMemberPath="DisplayName"
                      SelectionChanged="FolderFilter_SelectionChanged"/>
        </Grid>

        <!-- 历史列表 -->
        <ListView x:Name="HistoryList" Grid.Row="2" SelectionMode="None">
            <!-- ItemTemplate 保持之前的 Git 节点风格 -->
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:HistoryItem">
                    <Grid Height="80">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,16,0">
                            <TextBlock Text="{x:Bind TimeDisplay}" FontWeight="Bold" HorizontalAlignment="Right"/>
                            <TextBlock Text="{x:Bind DateDisplay}" FontSize="12" Foreground="Gray" HorizontalAlignment="Right"/>
                        </StackPanel>
                        <Grid Grid.Column="1">
                            <Rectangle Width="2" Fill="{ThemeResource SystemControlForegroundBaseLowBrush}" VerticalAlignment="Stretch" HorizontalAlignment="Center"/>
                            <Border Width="14" Height="14" CornerRadius="7" Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}" BorderBrush="{ThemeResource SystemControlForegroundBaseHighBrush}" BorderThickness="2" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Grid>
                        <Border Grid.Column="2" Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="4" Padding="12" Margin="0,4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="{x:Bind Message}" FontWeight="SemiBold"/>
                                    <!--TextBlock Text="{x:Bind CommitId}" FontSize="11" Opacity="0.5" FontFamily="Consolas"/-->
                                </StackPanel>
                                <Button Grid.Column="1" x:Uid="HistoryPage_RestoreButton" FontSize="12" Click="OnRestoreClick"/>
                            </Grid>
                        </Border>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- 空状态提示 -->
        <StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center" 
                    Visibility="{x:Bind IsEmpty, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
            <FontIcon Glyph="&#xE7BA;" FontSize="48" Opacity="0.3"/>
            <TextBlock x:Uid="HistoryPage_EmptyState" Margin="0,16,0,0" Opacity="0.5"/>
        </StackPanel>
    </Grid>
</Page>