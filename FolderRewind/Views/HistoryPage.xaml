<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="FolderRewind.Views.HistoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:FolderRewind.Models">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock x:Uid="HistoryPage_Title" Style="{ThemeResource TitleTextBlockStyle}" Margin="0,0,0,24"/>

        <!-- 筛选区 -->
        <Grid Grid.Row="1" Margin="0,0,0,24" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 移除了 ItemsSource绑定，改为代码设置 -->
            <ComboBox x:Name="ConfigFilter" x:Uid="HistoryPage_ConfigFilter" 
                      HorizontalAlignment="Stretch"
                      DisplayMemberPath="Name"
                      SelectionChanged="ConfigFilter_SelectionChanged"/>

            <ComboBox x:Name="FolderFilter" Grid.Column="1" x:Uid="HistoryPage_FolderFilter" 
                      HorizontalAlignment="Stretch"
                      DisplayMemberPath="DisplayName"
                      SelectionChanged="FolderFilter_SelectionChanged"/>
            
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>
                <TextBox x:Name="CommentFilterBox"
                         Grid.Row="1"
                         Margin="0,0,0,4"
                         x:Uid="HistoryPage_CommentFilter"
                         TextChanged="CommentFilterBox_TextChanged"/>
            </Grid>

            <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="12" VerticalAlignment="Bottom">
                <ToggleSwitch x:Name="UseColorsToggle"
                              x:Uid="HistoryPage_UseStatusColors"
                              IsOn="{x:Bind UseHistoryStatusColors, Mode=TwoWay}"
                              Toggled="UseColorsToggle_Toggled" />
                <Button x:Name="ClearMissingButton"
                        x:Uid="HistoryPage_ClearMissing"
                        IsEnabled="{x:Bind HasMissing, Mode=OneWay}"
                        Click="OnClearMissingClick" />
            </StackPanel>
        </Grid>

        <!-- 历史列表 -->
        <ListView x:Name="HistoryList" Grid.Row="2" SelectionMode="None">
            <!-- ItemTemplate 保持之前的 Git 节点风格 -->
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:HistoryItem">
                    <Grid Height="80">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,16,0">
                            <TextBlock Text="{x:Bind TimeDisplay}" FontWeight="Bold" HorizontalAlignment="Right"/>
                            <TextBlock Text="{x:Bind DateDisplay}" FontSize="12" Foreground="Gray" HorizontalAlignment="Right"/>
                        </StackPanel>
                        <Grid Grid.Column="1">
                            <Rectangle Width="2" Fill="{x:Bind TimelineLineBrush}" VerticalAlignment="Stretch" HorizontalAlignment="Center"/>
                            <Border Width="14" Height="14" CornerRadius="7"
                                    Background="{x:Bind TimelineNodeFillBrush}"
                                    BorderBrush="{x:Bind TimelineNodeBorderBrush}"
                                    BorderThickness="2"
                                    VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Grid>
                        <Border Grid.Column="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="4" Padding="12" Margin="0,4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="{x:Bind Message}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Bind FileSizeDisplay}" FontSize="11" Opacity="0.6"/>
                                    <!--TextBlock Text="{x:Bind CommitId}" FontSize="11" Opacity="0.5" FontFamily="Consolas"/-->
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                    <Button x:Uid="HistoryPage_RestoreButton" FontSize="12" Click="OnRestoreClick"/>
                                    <Button x:Uid="HistoryPage_DeleteButton" FontSize="12" Click="OnDeleteClick"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- 空状态提示 -->
        <StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center" 
                    Visibility="{x:Bind IsEmpty, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
            <FontIcon Glyph="&#xE7BA;" FontSize="48" Opacity="0.3"/>
            <TextBlock x:Uid="HistoryPage_EmptyState" Margin="0,16,0,0" Opacity="0.5"/>
        </StackPanel>
    </Grid>
</Page>